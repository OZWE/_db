function json_decode(str){return eval("("+str+")")}function fileSelected(e){var t,n=document.getElementById("f"+e).files[0],r=json_decode(document.getElementById("allowedTypes"+e).innerHTML);if(r.length>0&&r.indexOf(n.type)==-1){alert(kMsgWrongType+r+" ("+n.type+")");document.getElementById("f"+e).value=""}else{t=0;n.size>1048576?t=(Math.round(n.size*100/1048576)/100).toString()+"MB":t=(Math.round(n.size*100/1024)/100).toString()+"KB";document.getElementById("f"+e).style.display="none";document.getElementById("t"+e).style.display="block";document.getElementById("info"+e).innerHTML=t+" ("+n.type+")";document.getElementById("icon"+e).src=kImageLoading;uploadFile(e,n)}}function uploadFile(e,t){var n,r=new FormData;r.append("fileName",t.name);r.append(document.getElementById("f"+e).name,t);n=new XMLHttpRequest;n.upload.addEventListener("progress",function(t){uploadProgress(t,e)},!1);n.addEventListener("load",function(t){uploadComplete(t,e)},!1);n.addEventListener("error",function(t){uploadFailed(t,e)},!1);n.addEventListener("abort",function(t){uploadCanceled(t,e)},!1);n.open("post","/edit/upload.php?n="+document.getElementById("fNamePolicy"+e).value);n.send(r)}function uploadProgress(e,t){var n,r,i,s,o;if(e.lengthComputable){n=e.loaded;r=e.total;i=Math.round(e.loaded*100/e.total);if(n>102400){s=1048576;o="Mo"}else{s=1024;o="Ko"}document.getElementById("progressLabel"+t).innerHTML=(Math.round(n*10/s)/10).toString()+"/"+(Math.round(r*10/s)/10).toString()+" "+o;document.getElementById("progressBar"+t).style.width=i.toString()+"%"}else document.getElementById("progressBar"+t).innerHTML=kProgressUnknown}function uploadComplete(evt,fieldID){var uploadResponse=eval("("+evt.target.responseText+")");if(uploadResponse["status"]==1){document.getElementById("f"+fieldID).style.display="none";document.getElementById("fc"+fieldID).innerHTML="";document.getElementById("progressLabel"+fieldID).innerHTML=kLabelComplete;document.getElementById("icon"+fieldID).src=kImageSuccess;document.getElementById("fFileName"+fieldID).value=uploadResponse.file;document.getElementById("info"+fieldID).innerHTML=uploadResponse.file;document.getElementById("progressBar"+fieldID).style.background=kColorProgressComplete}else{document.getElementById("icon"+fieldID).src=kImageError;alert(uploadResponse.msg)}}function uploadFailed(){alert(kMsgFail)}function uploadCanceled(){alert(kMsgInterrupt)}var kMsgInterrupt="Téléversement interrompu. Veuillez réessayer en sélectionnant à nouveau votre fichier.",kMsgFail="Une erreur est survenue lors du chargement.",kMsgWrongType="Mauvais type de fichier. Les formats suivants sont acceptés : ",kImageLoading="i/loading.gif",kImageSuccess="i/ok.png",kImageError="i/error.png",kProgressUnknown="Chargement...",kColorProgressComplete="#888888",kLabelComplete="OK";Array.indexOf||(Array.prototype.indexOf=function(e){var t;for(t=0;t<this.length;t++)if(this[t]==e)return t;return-1});